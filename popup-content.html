<!-- Header con tÃ­tulo y botÃ³n modo oscuro -->
<header class="main-header">
  <h1 class="main-title">ğŸ“‹ Ficha Catastral</h1>
  <button class="btn-theme" id="btn-theme" title="Cambiar tema">ğŸŒ™</button>
</header>

<!-- SECCIÃ“N PRINCIPALES -->
<section class="seccion" id="seccion-principales">
  <div class="seccion-header">
    <h2>ğŸ“ Principales</h2>
    <div class="seccion-buttons">
      <button class="btn btn-save" data-action="save" data-section="principales">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="principales">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="seccion-content">
    <div class="seccion-content grid-3">
      <div class="field-group">
        <label for="principales-sector">SECTOR</label>
        <input type="text" id="principales-sector" name="sector">
      </div>
      <div class="field-group">
        <label for="principales-manzana">MANZANA</label>
        <input type="text" id="principales-manzana" name="manzana">
      </div>
      <div class="field-group">
        <label for="principales-lote">LOTE</label>
        <input type="text" id="principales-lote" name="lote">
      </div>
    </div>
  </div>
</section>

<!-- SECCIÃ“N UBICACIÃ“N -->
<section class="seccion" id="seccion-ubicacion">
  <div class="seccion-header">
    <h2>ğŸ“Œ UbicaciÃ³n</h2>
    <div class="seccion-buttons">
      <button class="btn btn-save" data-action="save" data-section="ubicacion">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="ubicacion">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="seccion-content grid-3">
    <div class="field-group">
      <label for="ubicacion-codigo-via">CÃ“DIGO VÃA</label>
      <input type="text" id="ubicacion-codigo-via" name="codigo_via">
    </div>
    <div class="field-group">
      <label for="ubicacion-codigo-hu">CÃ“DIGO HU</label>
      <input type="text" id="ubicacion-codigo-hu" name="codigo_hu">
    </div>
    <div class="field-group">
      <label for="ubicacion-n-municipal">NÂ° MUNICIPAL</label>
      <input type="text" id="ubicacion-n-municipal" name="n_municipal">
    </div>
    <div class="field-group">
      <label for="ubicacion-manzana">MANZANA</label>
      <input type="text" id="ubicacion-manzana" name="manzana">
    </div>
    <div class="field-group">
      <label for="ubicacion-lote">LOTE</label>
      <input type="text" id="ubicacion-lote" name="lote">
    </div>
    <div class="field-group">
      <label for="ubicacion-sub-lote">SUB-LOTE</label>
      <input type="text" id="ubicacion-sub-lote" name="sub_lote">
    </div>
  </div>
</section>

<!-- SECCIÃ“N DESCRIPCIÃ“N -->
<section class="seccion" id="seccion-descripcion">
  <div class="seccion-header">
    <h2>ğŸ“ DescripciÃ³n</h2>
    <div class="seccion-buttons">
      <button class="btn btn-save" data-action="save" data-section="descripcion">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="descripcion">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="seccion-content">
    <div class="field-row-3">
      <div class="field-group">
        <label for="descripcion-zonificacion">ZONIFICACIÃ“N</label>
        <input type="text" id="descripcion-zonificacion" name="zonificacion">
      </div>
      <div class="field-group">
        <label for="descripcion-area-adquirida">ÃREA ADQUIRIDA</label>
        <input type="text" id="descripcion-area-adquirida" name="area_adquirida">
      </div>
      <div class="field-group">
        <label for="descripcion-area-verificada">ÃREA VERIFICADA</label>
        <input type="text" id="descripcion-area-verificada" name="area_verificada">
      </div>
    </div>
    
    <!-- Tabla de Linderos -->
    <div class="tabla-linderos">
      <table class="tabla-simple">
        <thead>
          <tr>
            <th>LINDEROS</th>
            <th>MEDIDA</th>
            <th>COLINDANCIAS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="lindero-label">FRENTE</td>
            <td><input type="text" id="lindero-frente-medida" name="frente_medida"></td>
            <td><input type="text" id="lindero-frente-colindancia" name="frente_colindancia"></td>
          </tr>
          <tr>
            <td class="lindero-label">DERECHA</td>
            <td><input type="text" id="lindero-derecha-medida" name="derecha_medida"></td>
            <td><input type="text" id="lindero-derecha-colindancia" name="derecha_colindancia"></td>
          </tr>
          <tr>
            <td class="lindero-label">IZQUIERDA</td>
            <td><input type="text" id="lindero-izquierda-medida" name="izquierda_medida"></td>
            <td><input type="text" id="lindero-izquierda-colindancia" name="izquierda_colindancia"></td>
          </tr>
          <tr>
            <td class="lindero-label">FONDO</td>
            <td><input type="text" id="lindero-fondo-medida" name="fondo_medida"></td>
            <td><input type="text" id="lindero-fondo-colindancia" name="fondo_colindancia"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- SECCIÃ“N CONSTRUCCIONES -->
<section class="seccion" id="seccion-construcciones">
  <div class="seccion-header">
    <h2>ğŸ—ï¸ Construcciones</h2>
    <div class="seccion-buttons">
      <button class="btn btn-add" data-action="add-row" data-section="construcciones">â•</button>
      <button class="btn btn-save" data-action="save" data-section="construcciones">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="construcciones">ğŸ—‘ï¸</button>
      <button class="btn btn-execute" data-action="execute" data-section="construcciones" title="Ejecutar automatizaciÃ³n">â–¶ï¸</button>
    </div>
  </div>
  <div class="tabla-excel-container">
    <div class="tabla-instrucciones">
      <span class="instruccion-item">âŒ¨ï¸ Navega con flechas</span>
      <span class="instruccion-item">â†µ Enter = siguiente celda</span>
      <span class="instruccion-item">â‡¥ Tab = siguiente columna</span>
    </div>
    <table class="tabla-excel tabla-navegable" id="tabla-construcciones" data-table-type="construcciones">
      <thead>
        <tr>
          <th title="Cualquier valor">1</th>
          <th title="Cualquier valor">NPISO</th>
          <th title="0-12 (ej: 1, 01)">MES</th>
          <th title="4 dÃ­gitos">AÃ‘O</th>
          <th title="0-3">MEP</th>
          <th title="0-4">ECS</th>
          <th title="0-4">ECC</th>
          <th title="A-I">MURO</th>
          <th title="A-I">TECHO</th>
          <th title="A-I">PISO</th>
          <th title="A-I">PUERTA</th>
          <th title="A-I">REVEST</th>
          <th title="A-I">BAÃ‘O</th>
          <th title="A-I">INST</th>
          <th title="Cualquier valor">AREA</th>
          <th title="0-7">UCA</th>
          <th>ACC</th>
        </tr>
      </thead>
      <tbody id="tbody-construcciones">
        <tr data-row-id="1">
          <td><input type="text" name="npiso" data-col="0" data-validation="any"></td>
          <td><input type="text" name="mes" data-col="1" data-validation="mes"></td>
          <td><input type="text" name="anio" data-col="2" data-validation="anio"></td>
          <td><input type="text" name="mep" data-col="3" data-validation="mep"></td>
          <td><input type="text" name="ecs" data-col="4" data-validation="ecs"></td>
          <td><input type="text" name="ecc" data-col="5" data-validation="ecc"></td>
          <td><input type="text" name="muro" data-col="6" data-validation="letra"></td>
          <td><input type="text" name="techo" data-col="7" data-validation="letra"></td>
          <td><input type="text" name="piso" data-col="8" data-validation="letra"></td>
          <td><input type="text" name="puerta" data-col="9" data-validation="letra"></td>
          <td><input type="text" name="revest" data-col="10" data-validation="letra"></td>
          <td><input type="text" name="banio" data-col="11" data-validation="letra"></td>
          <td><input type="text" name="inst" data-col="12" data-validation="letra"></td>
          <td><input type="text" name="area" data-col="13" data-validation="any"></td>
          <td><input type="text" name="uca" data-col="14" data-validation="uca"></td>
          <td class="acciones-cell">
            <button class="btn-row btn-duplicate" data-action="duplicate">ğŸ“‹</button>
            <button class="btn-row btn-delete" data-action="delete">âŒ</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- SECCIÃ“N OBRAS -->
<section class="seccion" id="seccion-obras">
  <div class="seccion-header">
    <h2>ğŸ”§ Obras</h2>
    <div class="seccion-buttons">
      <button class="btn btn-add" data-action="add-row" data-section="obras">â•</button>
      <button class="btn btn-save" data-action="save" data-section="obras">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="obras">ğŸ—‘ï¸</button>
      <button class="btn btn-execute" data-action="execute" data-section="obras" title="Ejecutar automatizaciÃ³n">â–¶ï¸</button>
    </div>
  </div>
  <div class="tabla-excel-container">
    <div class="tabla-instrucciones">
      <span class="instruccion-item">âŒ¨ï¸ Navega con flechas</span>
      <span class="instruccion-item">â†µ Enter = siguiente celda</span>
      <span class="instruccion-item">â‡¥ Tab = siguiente columna</span>
    </div>
    <table class="tabla-excel tabla-navegable" id="tabla-obras" data-table-type="obras">
      <thead>
        <tr>
          <th title="Cualquier valor">1</th>
          <th title="Solo nÃºmeros">CÃ“DIGO</th>
          <th title="0-12 (ej: 1, 01)">MES</th>
          <th title="4 dÃ­gitos">AÃ‘O</th>
          <th title="0-3">MEP</th>
          <th title="0-4">ECS</th>
          <th title="0-4">ECC</th>
          <th title="Cualquier valor">TOTAL</th>
          <th title="0-7">UCA</th>
          <th>ACC</th>
        </tr>
      </thead>
      <tbody id="tbody-obras">
        <tr data-row-id="1">
          <td><input type="text" name="codigo" data-col="0" data-validation="numero"></td>
          <td><input type="text" name="mes" data-col="1" data-validation="mes"></td>
          <td><input type="text" name="anio" data-col="2" data-validation="anio"></td>
          <td><input type="text" name="mep" data-col="3" data-validation="mep"></td>
          <td><input type="text" name="ecs" data-col="4" data-validation="ecs"></td>
          <td><input type="text" name="ecc" data-col="5" data-validation="ecc"></td>
          <td><input type="text" name="total" data-col="6" data-validation="any"></td>
          <td><input type="text" name="uca" data-col="7" data-validation="uca"></td>
          <td class="acciones-cell">
            <button class="btn-row btn-duplicate" data-action="duplicate">ğŸ“‹</button>
            <button class="btn-row btn-delete" data-action="delete">âŒ</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- SECCIÃ“N INSCRIPCIÃ“N -->
<section class="seccion" id="seccion-inscripcion">
  <div class="seccion-header">
    <h2>ğŸ“œ InscripciÃ³n</h2>
    <div class="seccion-buttons">
      <button class="btn btn-save" data-action="save" data-section="inscripcion">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="inscripcion">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="seccion-content grid-3">
    <div class="field-group">
      <label for="inscripcion-numero">NÃšMERO</label>
      <input type="text" id="inscripcion-numero" name="numero">
    </div>
    <div class="field-group">
      <label for="inscripcion-asiento">ASIENTO</label>
      <input type="text" id="inscripcion-asiento" name="asiento">
    </div>
    <div class="field-group">
      <label for="inscripcion-fecha">FECHA</label>
      <input type="text" id="inscripcion-fecha" name="fecha" placeholder="DD/MM/YYYY">
    </div>
  </div>
</section>

<!-- SECCIÃ“N FINAL -->
<section class="seccion" id="seccion-final">
  <div class="seccion-header">
    <h2>âœ… Final</h2>
    <div class="seccion-buttons">
      <button class="btn btn-save" data-action="save" data-section="final">ğŸ’¾</button>
      <button class="btn btn-clear" data-action="clear" data-section="final">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="seccion-content">
    <div class="field-group field-full">
      <label for="final-observaciones">OBSERVACIONES</label>
      <textarea id="final-observaciones" name="observaciones" rows="4"></textarea>
    </div>
    
    <div class="subseccion-row">
      <div class="subseccion">
        <h4>ğŸ‘¨â€ğŸ’¼ SUPERVISOR</h4>
        <div class="field-group">
          <label for="final-supervisor-nombre">NOMBRE</label>
          <input type="text" id="final-supervisor-nombre" name="supervisor_nombre">
        </div>
        <div class="field-group">
          <label for="final-supervisor-fecha">FECHA</label>
          <input type="text" id="final-supervisor-fecha" name="supervisor_fecha" placeholder="DD/MM/YYYY">
        </div>
      </div>
      
      <div class="subseccion">
        <h4>ğŸ‘· TÃ‰CNICO</h4>
        <div class="field-group">
          <label for="final-tecnico-nombre">NOMBRE</label>
          <input type="text" id="final-tecnico-nombre" name="tecnico_nombre">
        </div>
        <div class="field-group">
          <label for="final-tecnico-fecha">FECHA</label>
          <input type="text" id="final-tecnico-fecha" name="tecnico_fecha" placeholder="DD/MM/YYYY">
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Botones globales -->
<div class="global-actions">
  <button class="btn btn-global-save" id="btn-guardar-todo">ğŸ’¾ Guardar</button>
  <button class="btn btn-global-clear" id="btn-limpiar-todo">ğŸ—‘ï¸ Limpiar</button>
  <button class="btn btn-global-export" id="btn-exportar">ğŸ“¤ Exportar</button>
  <button class="btn btn-global-import" id="btn-importar">ğŸ“¥ Importar</button>
  <input type="file" id="input-importar" accept=".json" style="display: none;">
</div>

<!-- Estilos adicionales para validaciÃ³n y navegaciÃ³n -->
<style>
/* Instrucciones de navegaciÃ³n */
.tabla-instrucciones {
  display: flex;
  gap: 15px;
  padding: 8px 12px;
  background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
  border-radius: 8px 8px 0 0;
  border: 1px solid #bae6fd;
  border-bottom: none;
  font-size: 11px;
  color: #0369a1;
}

.dark-mode .tabla-instrucciones {
  background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
  border-color: #334155;
  color: #7dd3fc;
}

.instruccion-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Estilos de validaciÃ³n */
.tabla-excel input.valid {
  background-color: #f0fdf4 !important;
  border-color: #86efac !important;
}

.tabla-excel input.invalid {
  background-color: #fef2f2 !important;
  border-color: #fca5a5 !important;
  animation: shake 0.3s ease-in-out;
}

.dark-mode .tabla-excel input.valid {
  background-color: #14532d !important;
  border-color: #22c55e !important;
}

.dark-mode .tabla-excel input.invalid {
  background-color: #450a0a !important;
  border-color: #ef4444 !important;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  75% { transform: translateX(3px); }
}

/* Celda activa/seleccionada */
.tabla-excel input:focus {
  outline: none !important;
  box-shadow: 0 0 0 2px #3b82f6 !important;
  border-color: #3b82f6 !important;
  background-color: #eff6ff !important;
}

.dark-mode .tabla-excel input:focus {
  box-shadow: 0 0 0 2px #60a5fa !important;
  border-color: #60a5fa !important;
  background-color: #1e3a5f !important;
}

/* Indicador de celda seleccionada en fila */
.tabla-excel tr.row-active {
  background-color: #f0f9ff !important;
}

.dark-mode .tabla-excel tr.row-active {
  background-color: #1e293b !important;
}

/* Tooltip de validaciÃ³n */
.tabla-excel th {
  cursor: help;
  position: relative;
}

.tabla-excel th:hover::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: #1e293b;
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 10px;
  white-space: nowrap;
  z-index: 100;
  opacity: 0;
  animation: fadeIn 0.2s ease forwards;
  animation-delay: 0.3s;
}

@keyframes fadeIn {
  to { opacity: 1; }
}

/* Indicador de errores en secciÃ³n */
.validation-summary {
  margin-top: 10px;
  padding: 10px 15px;
  background: #fef2f2;
  border: 1px solid #fca5a5;
  border-radius: 8px;
  font-size: 12px;
  color: #dc2626;
}

.dark-mode .validation-summary {
  background: #450a0a;
  border-color: #ef4444;
  color: #fca5a5;
}

.validation-summary ul {
  margin: 5px 0 0 20px;
  padding: 0;
}

.validation-summary li {
  margin: 3px 0;
}

/* Mejoras en tabla excel para navegaciÃ³n */
.tabla-excel tbody tr {
  transition: background-color 0.15s ease;
}

.tabla-excel input {
  transition: all 0.15s ease;
}

/* Contador de filas */
.tabla-excel tbody tr::before {
  content: attr(data-row-index);
  position: absolute;
  left: -25px;
  color: #94a3b8;
  font-size: 10px;
  width: 20px;
  text-align: right;
}
</style>