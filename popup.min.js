// @ts-nocheck
const STORAGE_KEY="fichaCatastralData",THEME_KEY="fichaCatastralTheme",SECCIONES_CONFIG={principales:{fields:["principales-sector","principales-manzana","principales-lote"]},ubicacion:{fields:["ubicacion-codigo-via","ubicacion-codigo-hu","ubicacion-n-municipal","ubicacion-manzana","ubicacion-lote","ubicacion-sub-lote"]},descripcion:{fields:["descripcion-zonificacion","descripcion-area-adquirida","descripcion-area-verificada","lindero-frente-medida","lindero-frente-colindancia","lindero-derecha-medida","lindero-derecha-colindancia","lindero-izquierda-medida","lindero-izquierda-colindancia","lindero-fondo-medida","lindero-fondo-colindancia"]},inscripcion:{fields:["inscripcion-numero","inscripcion-asiento","inscripcion-fecha"]},final:{fields:["final-observaciones","final-supervisor-nombre","final-supervisor-fecha","final-tecnico-nombre","final-tecnico-fecha"]}},TABLAS_CONFIG={construcciones:{tableId:"tabla-construcciones",tbodyId:"tbody-construcciones",columns:["npiso","mes","anio","mep","ecs","ecc","muro","techo","piso","puerta","revest","banio","inst","area","uca"]},obras:{tableId:"tabla-obras",tbodyId:"tbody-obras",columns:["codigo","mes","anio","mep","ecs","ecc","total","uca"]}},VALIDACIONES={construcciones:{npiso:{type:"any",label:"NPISO"},mes:{type:"mes",label:"MES",errorMsg:"Debe ser 0-12 (ej: 1, 01, 02)"},anio:{type:"anio",label:"A√ëO",errorMsg:"Debe tener 4 d√≠gitos"},mep:{type:"mep",label:"MEP",errorMsg:"Debe ser 0-3 (ej: 0, 01, 02, 03)"},ecs:{type:"ecs",label:"ECS",errorMsg:"Debe ser 0-4 (ej: 0, 01, 02, 03, 04)"},ecc:{type:"ecc",label:"ECC",errorMsg:"Debe ser 0-4 (ej: 0, 01, 02, 03, 04)"},muro:{type:"letra",label:"MURO",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},techo:{type:"letra",label:"TECHO",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},piso:{type:"letra",label:"PISO",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},puerta:{type:"letra",label:"PUERTA",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},revest:{type:"letra",label:"REVEST",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},banio:{type:"letra",label:"BA√ëO",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},inst:{type:"letra",label:"INST",errorMsg:"Debe ser A-I, vac√≠o, 0 o 00"},area:{type:"any",label:"AREA"},uca:{type:"uca",label:"UCA",errorMsg:"Debe ser 0-7 (ej: 0, 01, 02...07)"}},obras:{codigo:{type:"numero",label:"C√ìDIGO",errorMsg:"Solo n√∫meros permitidos"},mes:{type:"mes",label:"MES",errorMsg:"Debe ser 0-12 (ej: 1, 01, 02)"},anio:{type:"anio",label:"A√ëO",errorMsg:"Debe tener 4 d√≠gitos"},mep:{type:"mep",label:"MEP",errorMsg:"Debe ser 0-3 (ej: 0, 01, 02, 03)"},ecs:{type:"ecs",label:"ECS",errorMsg:"Debe ser 0-4 (ej: 0, 01, 02, 03, 04)"},ecc:{type:"ecc",label:"ECC",errorMsg:"Debe ser 0-4 (ej: 0, 01, 02, 03, 04)"},total:{type:"any",label:"TOTAL"},uca:{type:"uca",label:"UCA",errorMsg:"Debe ser 0-7 (ej: 0, 01, 02...07)"}}};function validarCampo(e,t){const a=e.trim();switch(t){case"any":default:return{valid:!0,normalized:a};case"mes":if(""===a||"0"===a||"00"===a)return{valid:!0,normalized:"0"};const e=parseInt(a,10);return!isNaN(e)&&e>=0&&e<=12?{valid:!0,normalized:a}:{valid:!1};case"anio":return""===a?{valid:!0,normalized:""}:/^\d{4}$/.test(a)?{valid:!0,normalized:a}:{valid:!1};case"mep":return""===a||"0"===a||"00"===a?{valid:!0,normalized:"0"}:/^(0?[0-3])$/.test(a)?{valid:!0,normalized:a}:{valid:!1};case"ecs":case"ecc":return""===a||"0"===a||"00"===a?{valid:!0,normalized:"0"}:/^(0?[0-4])$/.test(a)?{valid:!0,normalized:a}:{valid:!1};case"letra":return""===a||"0"===a||"00"===a?{valid:!0,normalized:"0"}:/^[A-Ia-i]$/.test(a)?{valid:!0,normalized:a.toUpperCase()}:{valid:!1};case"uca":return""===a||"0"===a||"00"===a?{valid:!0,normalized:"0"}:/^(0?[0-7])$/.test(a)?{valid:!0,normalized:a}:{valid:!1};case"numero":return""===a?{valid:!0,normalized:""}:/^\d+$/.test(a)?{valid:!0,normalized:a}:{valid:!1}}}function validarFilaTabla(e,t){const a=VALIDACIONES[t];if(!a)return{valid:!0,errors:[]};const n=[];return e.querySelectorAll("input[name]").forEach(e=>{const t=e.name,o=a[t];if(o){const t=validarCampo(e.value,o.type);e.classList.remove("valid","invalid"),t.valid?""!==e.value.trim()&&e.classList.add("valid"):(e.classList.add("invalid"),n.push({field:o.label,message:o.errorMsg||"Valor inv√°lido",input:e}))}}),{valid:0===n.length,errors:n}}function validarTablaCompleta(e){const t=TABLAS_CONFIG[e];if(!t)return{valid:!0,allErrors:[]};const a=document.getElementById(t.tbodyId);if(!a)return{valid:!0,allErrors:[]};const n=a.querySelectorAll("tr"),o=[];let r=1;return n.forEach(t=>{const{valid:a,errors:n}=validarFilaTabla(t,e);a||n.forEach(e=>{o.push({fila:r,...e})}),r++}),{valid:0===o.length,allErrors:o}}function mostrarErroresValidacion(e,t){const a=document.querySelector(`#seccion-${e} .validation-summary`);if(a&&a.remove(),0===t.length)return;const n=document.querySelector(`#seccion-${e} .tabla-excel-container`),o=document.createElement("div");o.className="validation-summary";const r=t.map(e=>`<li>Fila ${e.fila}, ${e.field}: ${e.message}</li>`).join("");o.innerHTML=`\n    <strong>‚ö†Ô∏è Errores de validaci√≥n (${t.length}):</strong>\n    <ul>${r}</ul>\n  `,n.appendChild(o)}function limpiarErroresValidacion(e){const t=document.querySelector(`#seccion-${e} .validation-summary`);t&&t.remove();const a=TABLAS_CONFIG[e];if(!a)return;const n=document.getElementById(a.tbodyId);n&&n.querySelectorAll("input").forEach(e=>{e.classList.remove("valid","invalid")})}function setupExcelNavigation(){document.querySelectorAll(".tabla-navegable").forEach(e=>{const t=e.querySelector("tbody");t&&(t.addEventListener("keydown",a=>{const n=a.target;if("INPUT"!==n.tagName)return;const o=n.closest("td"),r=n.closest("tr"),i=e.dataset.tableType,c=Array.from(t.querySelectorAll("tr")),l=c.indexOf(r),s=Array.from(r.querySelectorAll("td:not(.acciones-cell)")),d=s.indexOf(o);let u=null;switch(a.key){case"ArrowUp":if(a.preventDefault(),l>0){const e=c[l-1].querySelectorAll("td:not(.acciones-cell)");e[d]&&(u=e[d].querySelector("input"))}break;case"ArrowDown":if(a.preventDefault(),l<c.length-1){const e=c[l+1].querySelectorAll("td:not(.acciones-cell)");e[d]&&(u=e[d].querySelector("input"))}break;case"ArrowLeft":if(0===n.selectionStart&&0===n.selectionEnd)if(a.preventDefault(),d>0)u=s[d-1].querySelector("input");else if(l>0){const e=c[l-1].querySelectorAll("td:not(.acciones-cell)");u=e[e.length-1].querySelector("input")}break;case"ArrowRight":if(n.selectionStart===n.value.length)if(a.preventDefault(),d<s.length-1)u=s[d+1].querySelector("input");else if(l<c.length-1){u=c[l+1].querySelectorAll("td:not(.acciones-cell)")[0].querySelector("input")}break;case"Enter":if(a.preventDefault(),d<s.length-1)u=s[d+1].querySelector("input");else if(l<c.length-1){u=c[l+1].querySelectorAll("td:not(.acciones-cell)")[0].querySelector("input")}else addTableRow(i),setTimeout(()=>{const e=t.querySelectorAll("tr"),a=e[e.length-1].querySelector("td:not(.acciones-cell) input");a&&a.focus()},50);break;case"Tab":setTimeout(()=>{validarCampoEnTiempoReal(n,i)},0);break;case"Escape":n.blur()}u&&(u.focus(),u.select())}),t.addEventListener("focusin",e=>{"INPUT"===e.target.tagName&&(t.querySelectorAll("tr").forEach(e=>e.classList.remove("row-active")),e.target.closest("tr").classList.add("row-active"))}),t.addEventListener("focusout",t=>{if("INPUT"===t.target.tagName){const a=e.dataset.tableType;validarCampoEnTiempoReal(t.target,a)}}),t.addEventListener("focus",e=>{"INPUT"===e.target.tagName&&setTimeout(()=>e.target.select(),0)},!0))})}function validarCampoEnTiempoReal(e,t){const a=e.name,n=VALIDACIONES[t];if(!n||!n[a])return;const o=n[a],r=validarCampo(e.value,o.type);e.classList.remove("valid","invalid"),""!==e.value.trim()&&(r.valid?(e.classList.add("valid"),r.normalized!==e.value&&(e.value=r.normalized)):e.classList.add("invalid"))}async function checkLicenseBeforeLoad(){document.querySelector(".container").innerHTML='\n    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 400px; gap: 20px;">\n      <div style="width: 50px; height: 50px; border: 4px solid #e2e8f0; border-top-color: #2563eb; border-radius: 50%; animation: spin 1s linear infinite;"></div>\n      <p style="color: #64748b; font-size: 14px;">Verificando licencia...</p>\n    </div>\n    <style>\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n  ';try{const e=await LicenseManager.verifyLicense();return e.valid?(await loadMainContent(),!0):(showLicenseError(e),!1)}catch(e){return console.error("[Popup] Error verificando licencia:",e),showLicenseError({message:"Error al verificar licencia. Por favor intente nuevamente."}),!1}}function showLicenseError(e){const t=document.querySelector(".container");let a=e.message||"Licencia no v√°lida",n="";e.notFound?n=`\n      <p style="margin-top: 15px; font-size: 12px; color: #64748b;">\n        Licencia no encontrada.<br>\n        Por favor contacte al <strong>üì± ${LICENSE_CONFIG.SUPPORT_PHONE}</strong>\n      </p>\n    `:e.expired?n=`\n      <p style="margin-top: 10px; font-size: 12px; color: #dc2626;">\n        Expir√≥ el: ${LicenseManager.formatExpirationDate(e.expira_en)}\n      </p>\n      <p style="margin-top: 10px; font-size: 12px; color: #64748b;">\n        Para renovar contacte al <strong>üì± ${LICENSE_CONFIG.SUPPORT_PHONE}</strong>\n      </p>\n    `:e.needsActivation&&(n='\n      <p style="margin-top: 15px; font-size: 12px; color: #64748b;">\n        Por favor active su licencia para continuar.\n      </p>\n    '),t.innerHTML=`\n    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 400px; padding: 30px; text-align: center;">\n      <div style="font-size: 64px; margin-bottom: 20px;">üîí</div>\n      <h2 style="color: #dc2626; font-size: 18px; margin-bottom: 10px;">Licencia Requerida</h2>\n      <p style="color: #64748b; font-size: 13px;">${a}</p>\n      ${n}\n      <button id="btn-open-license" style="\n        margin-top: 25px;\n        padding: 12px 24px;\n        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.3s ease;\n      ">\n        üîê Activar Licencia\n      </button>\n      <a href="https://wa.me/51${LICENSE_CONFIG.SUPPORT_PHONE}" target="_blank" style="\n        margin-top: 15px;\n        color: #16a34a;\n        font-size: 12px;\n        text-decoration: none;\n      ">\n        üí¨ Contactar soporte v√≠a WhatsApp\n      </a>\n    </div>\n  `,document.getElementById("btn-open-license").addEventListener("click",()=>{chrome.tabs.create({url:"license.html"})})}async function loadMainContent(){const e=await fetch("popup-content.html"),t=await e.text();document.querySelector(".container").innerHTML=t,initTheme(),loadStoredData(),setupEventListeners(),setupExcelNavigation(),showLicenseIndicator()}async function showLicenseIndicator(){const e=await LicenseManager.getSavedLicenseData();if(e.data&&e.data.expira_en){const t=LicenseManager.getDaysRemaining(e.data.expira_en),a=document.querySelector(".main-header");if(a){const n=document.createElement("div");n.className="license-indicator",n.style.cssText=`\n        font-size: 9px;\n        padding: 3px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n        ${t<=7?"background: #fef2f2; color: #dc2626;":t<=30?"background: #fef3c7; color: #92400e;":"background: #dcfce7; color: #166534;"}\n      `,n.textContent=`üìã ${t} d√≠as`,n.title=`Licencia v√°lida hasta: ${LicenseManager.formatExpirationDate(e.data.expira_en)}`,n.addEventListener("click",()=>{chrome.tabs.create({url:"license.html"})}),a.insertBefore(n,a.querySelector(".btn-theme"))}}}function showToast(e,t="info"){const a=document.querySelector(".toast");a&&a.remove();const n=document.createElement("div");n.className=`toast ${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease forwards",setTimeout(()=>n.remove(),300)},2e3)}function generateRowId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function initTheme(){chrome.storage.local.get([THEME_KEY],e=>{if("dark"===e[THEME_KEY]){document.body.classList.add("dark-mode");const e=document.getElementById("btn-theme");e&&(e.textContent="‚òÄÔ∏è")}})}function toggleTheme(){const e=document.body.classList.toggle("dark-mode"),t=document.getElementById("btn-theme");t&&(t.textContent=e?"‚òÄÔ∏è":"üåô"),chrome.storage.local.set({[THEME_KEY]:e?"dark":"light"}),showToast(e?"Modo oscuro activado":"Modo claro activado","info")}async function getAllStoredData(){return new Promise(e=>{chrome.storage.local.get([STORAGE_KEY],t=>{e(t[STORAGE_KEY]||{})})})}async function saveAllData(e){return new Promise(t=>{chrome.storage.local.set({[STORAGE_KEY]:e},t)})}async function getSectionData(e){return(await getAllStoredData())[e]||{}}async function saveSectionData(e,t){const a=await getAllStoredData();a[e]=t,await saveAllData(a)}function getSectionValuesFromDOM(e){const t=SECCIONES_CONFIG[e];if(!t)return{};const a={};return t.fields.forEach(e=>{const t=document.getElementById(e);t&&(a[e]=t.value)}),a}function setSectionValuesInDOM(e,t){const a=SECCIONES_CONFIG[e];a&&a.fields.forEach(e=>{const a=document.getElementById(e);a&&void 0!==t[e]&&(a.value=t[e])})}function clearSectionInDOM(e){const t=SECCIONES_CONFIG[e];t&&t.fields.forEach(e=>{const t=document.getElementById(e);t&&(t.value="")})}async function saveSection(e){const t=getSectionValuesFromDOM(e);await saveSectionData(e,t),showToast(`"${e}" guardado`,"success")}async function clearSection(e){clearSectionInDOM(e),await saveSectionData(e,{}),showToast(`"${e}" limpiado`,"info")}function createTableRow(e,t={}){const a=TABLAS_CONFIG[e];if(!a)return null;const n=document.createElement("tr"),o=t.rowId||generateRowId();n.setAttribute("data-row-id",o),a.columns.forEach((a,o)=>{const r=document.createElement("td"),i=document.createElement("input");i.type="text",i.name=a,i.value=t[a]||"",i.setAttribute("data-col",o);const c=VALIDACIONES[e]?.[a];c&&i.setAttribute("data-validation",c.type),r.appendChild(i),n.appendChild(r)});const r=document.createElement("td");return r.className="acciones-cell",r.innerHTML='\n    <button class="btn-row btn-duplicate" data-action="duplicate">üìã</button>\n    <button class="btn-row btn-delete" data-action="delete">‚ùå</button>\n  ',n.appendChild(r),n}function getTableDataFromDOM(e){const t=TABLAS_CONFIG[e];if(!t)return[];const a=document.getElementById(t.tbodyId);if(!a)return[];const n=a.querySelectorAll("tr"),o=[];return n.forEach(e=>{const a={rowId:e.getAttribute("data-row-id")};t.columns.forEach(t=>{const n=e.querySelector(`input[name="${t}"]`);n&&(a[t]=n.value)}),o.push(a)}),o}function setTableDataInDOM(e,t){const a=TABLAS_CONFIG[e];if(!a)return;const n=document.getElementById(a.tbodyId);n&&(n.innerHTML="",t&&t.length>0?t.forEach(t=>{const a=createTableRow(e,t);n.appendChild(a)}):n.appendChild(createTableRow(e)))}function clearTableInDOM(e){const t=TABLAS_CONFIG[e];if(!t)return;const a=document.getElementById(t.tbodyId);a&&(a.innerHTML="",a.appendChild(createTableRow(e)),limpiarErroresValidacion(e))}function addTableRow(e){const t=TABLAS_CONFIG[e];if(!t)return;const a=document.getElementById(t.tbodyId);if(!a)return;const n=createTableRow(e);a.appendChild(n),n.querySelector("input").focus()}function duplicateTableRow(e,t){const a=TABLAS_CONFIG[t];if(!a)return;const n={};a.columns.forEach(t=>{const a=e.querySelector(`input[name="${t}"]`);a&&(n[t]=a.value)});const o=createTableRow(t,n);e.parentNode.insertBefore(o,e.nextSibling),showToast("Fila duplicada","success")}function deleteTableRow(e,t){const a=TABLAS_CONFIG[t];if(!a)return;const n=document.getElementById(a.tbodyId);n&&(n.querySelectorAll("tr").length<=1?showToast("No se puede eliminar la √∫ltima fila","error"):(e.remove(),showToast("Fila eliminada","info")))}async function saveTable(e){const{valid:t,allErrors:a}=validarTablaCompleta(e);if(!t)return mostrarErroresValidacion(e,a),showToast(`Hay ${a.length} error(es) de validaci√≥n`,"error"),void(a.length>0&&a[0].input&&(a[0].input.focus(),a[0].input.select()));limpiarErroresValidacion(e);const n=getTableDataFromDOM(e);await saveSectionData(e,n),showToast(`"${e}" guardado ‚úì`,"success")}async function clearTable(e){clearTableInDOM(e),await saveSectionData(e,[]),showToast(`"${e}" limpiado`,"info")}async function executeAutomation(e){const t=getTableDataFromDOM(e).filter(t=>TABLAS_CONFIG[e].columns.some(e=>t[e]&&""!==t[e].trim()));if(0===t.length)return void showToast("No hay datos para ejecutar","error");const{valid:a,allErrors:n}=validarTablaCompleta(e);if(!a)return mostrarErroresValidacion(e,n),showToast(`Corrige ${n.length} error(es) antes de ejecutar`,"error"),void(n.length>0&&n[0].input&&(n[0].input.focus(),n[0].input.select()));limpiarErroresValidacion(e);const o=t.map(t=>{const a={...t},n=VALIDACIONES[e];return Object.keys(t).forEach(e=>{if(n&&n[e]){const o=validarCampo(t[e],n[e].type);o.valid&&(a[e]=o.normalized)}}),a});await saveSectionData(e,o),showToast(`Ejecutando ${e} (${o.length} filas)...`,"info"),chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0]&&chrome.tabs.sendMessage(t[0].id,{action:"executeSection",section:e,data:o},e=>{chrome.runtime.lastError?showToast("Error: No se pudo conectar con la p√°gina","error"):e&&e.success&&showToast("Automatizaci√≥n terminada ‚úì","success")})})}async function saveAll(){const e={};let t=!1,a=0;for(const t of Object.keys(SECCIONES_CONFIG))e[t]=getSectionValuesFromDOM(t);for(const n of Object.keys(TABLAS_CONFIG)){const{valid:o,allErrors:r}=validarTablaCompleta(n);o?limpiarErroresValidacion(n):(t=!0,a+=r.length,mostrarErroresValidacion(n,r)),e[n]=getTableDataFromDOM(n)}t?showToast(`Hay ${a} error(es) de validaci√≥n`,"error"):(await saveAllData(e),showToast("Todo guardado correctamente ‚úì","success"))}async function clearAll(){if(confirm("¬øLimpiar todos los datos?")){for(const e of Object.keys(SECCIONES_CONFIG))clearSectionInDOM(e);for(const e of Object.keys(TABLAS_CONFIG))clearTableInDOM(e);await saveAllData({}),showToast("Todo limpiado","info")}}async function exportData(){const e={};for(const t of Object.keys(SECCIONES_CONFIG))e[t]=getSectionValuesFromDOM(t);for(const t of Object.keys(TABLAS_CONFIG))e[t]=getTableDataFromDOM(t);const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`ficha_catastral_${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),showToast("Datos exportados","success")}async function importData(e){try{const t=await e.text(),a=JSON.parse(t);for(const e of Object.keys(SECCIONES_CONFIG))a[e]&&setSectionValuesInDOM(e,a[e]);for(const e of Object.keys(TABLAS_CONFIG))a[e]&&setTableDataInDOM(e,a[e]);await saveAllData(a),showToast("Datos importados","success")}catch(e){console.error("Error al importar:",e),showToast("Error al importar","error")}}async function loadStoredData(){const e=await getAllStoredData();for(const t of Object.keys(SECCIONES_CONFIG))e[t]&&setSectionValuesInDOM(t,e[t]);for(const t of Object.keys(TABLAS_CONFIG))e[t]&&e[t].length>0&&setTableDataInDOM(t,e[t])}function setupEventListeners(){const e=document.getElementById("btn-theme");e&&e.addEventListener("click",toggleTheme),document.addEventListener("click",async e=>{const t=e.target.closest("button");if(!t)return;const a=t.dataset.action,n=t.dataset.section;if("save"===a&&SECCIONES_CONFIG[n])await saveSection(n);else if("clear"===a&&SECCIONES_CONFIG[n])await clearSection(n);else if("save"===a&&TABLAS_CONFIG[n])await saveTable(n);else if("clear"===a&&TABLAS_CONFIG[n])await clearTable(n);else if("add-row"===a&&TABLAS_CONFIG[n])addTableRow(n);else if("duplicate"===a){duplicateTableRow(t.closest("tr"),t.closest("table").id.replace("tabla-",""))}else if("delete"===a){deleteTableRow(t.closest("tr"),t.closest("table").id.replace("tabla-",""))}else"execute"===a&&TABLAS_CONFIG[n]&&await executeAutomation(n)});const t=document.getElementById("btn-guardar-todo");t&&t.addEventListener("click",saveAll);const a=document.getElementById("btn-limpiar-todo");a&&a.addEventListener("click",clearAll);const n=document.getElementById("btn-exportar");n&&n.addEventListener("click",exportData);const o=document.getElementById("btn-importar");o&&o.addEventListener("click",()=>{document.getElementById("input-importar").click()});const r=document.getElementById("input-importar");r&&r.addEventListener("change",e=>{e.target.files.length>0&&(importData(e.target.files[0]),e.target.value="")})}document.addEventListener("DOMContentLoaded",()=>{checkLicenseBeforeLoad()}),window.FichaCatastralAPI={STORAGE_KEY:STORAGE_KEY,SECCIONES_CONFIG:SECCIONES_CONFIG,TABLAS_CONFIG:TABLAS_CONFIG,VALIDACIONES:VALIDACIONES,getAllData:getAllStoredData,getSectionData:getSectionData,saveSectionData:saveSectionData,validarCampo:validarCampo,validarTablaCompleta:validarTablaCompleta};