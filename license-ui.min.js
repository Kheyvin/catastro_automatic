// @ts-nocheck
document.addEventListener("DOMContentLoaded",async()=>{const e={activationForm:document.getElementById("activation-form"),licenseStatus:document.getElementById("license-status"),licenseInput:document.getElementById("license-code"),btnActivate:document.getElementById("btn-activate"),btnContinue:document.getElementById("btn-continue"),btnChangeLicense:document.getElementById("btn-change-license"),messageBox:document.getElementById("message-box"),expirationDate:document.getElementById("expiration-date"),daysRemaining:document.getElementById("days-remaining")};async function n(){const n=e.licenseInput.value.trim();if(!n)return i("warning","Por favor ingrese un c贸digo de licencia v谩lido."),void e.licenseInput.focus();o(!0),c();try{const e=await LicenseManager.activateLicense(n);e.success?(i("success","隆Licencia activada correctamente! Redirigiendo..."),setTimeout(()=>{a({expira_en:e.expira_en})},1500)):e.notFound?i("error",`Licencia no encontrada. Por favor verifique el c贸digo o contacte al  ${LICENSE_CONFIG.SUPPORT_PHONE}`):e.expired?i("error",`Esta licencia ha expirado el ${LicenseManager.formatExpirationDate(e.expira_en)}. Contacte al  ${LICENSE_CONFIG.SUPPORT_PHONE} para renovar.`):i("error",e.message||"Error al activar licencia.")}catch(e){console.error("[License UI] Activation error:",e),i("error","Error de conexi贸n. Por favor verifique su conexi贸n a internet.")}o(!1)}function t(){e.activationForm.classList.remove("hidden"),e.licenseStatus.classList.remove("active"),e.licenseInput.focus()}function a(n){e.activationForm.classList.add("hidden"),e.licenseStatus.classList.add("active"),e.expirationDate.textContent=LicenseManager.formatExpirationDate(n.expira_en),e.daysRemaining.textContent=LicenseManager.getDaysRemaining(n.expira_en);const t=LicenseManager.getDaysRemaining(n.expira_en);e.daysRemaining.style.color=t<=7?"#dc2626":t<=30?"#f59e0b":"#16a34a"}function i(n,t){e.messageBox.className=`message-box ${n}`,e.messageBox.textContent=t,e.messageBox.style.display="block"}function c(){e.messageBox.style.display="none"}function o(n){e.btnActivate.disabled=n,e.btnActivate.classList.toggle("loading",n)}await async function(){o(!0);try{const e=await LicenseManager.verifyLicense();e.valid?a(e):e.needsActivation?t():e.expired?(t(),i("error",`La licencia ha expirado el ${LicenseManager.formatExpirationDate(e.expira_en)}. Por favor renueve su licencia.`)):e.notFound&&(t(),i("error",`Licencia no encontrada. Por favor contacte al  ${LICENSE_CONFIG.SUPPORT_PHONE}`))}catch(e){console.error("[License UI] Error:",e),t(),i("error","Error al verificar licencia. Por favor intente nuevamente.")}o(!1)}(),e.btnActivate.addEventListener("click",n),e.btnContinue.addEventListener("click",function(){window.close()}),e.btnChangeLicense.addEventListener("click",async function(){confirm("驴Est谩 seguro de que desea cambiar la licencia actual?")&&(await LicenseManager.clearLicenseData(),t(),e.licenseInput.value="",c())}),e.licenseInput.addEventListener("keypress",e=>{"Enter"===e.key&&n()})});